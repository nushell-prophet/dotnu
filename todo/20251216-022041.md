---
status: draft
created: 20251216-022041
updated: 20251216-022041
---
# Flatten integration test script generation

Create a helper for generating intermediate test scripts with all commands written verbatim.

## Problem

In `toolkit.nu`, integration tests use patterns like:
```nushell
[
    (test-dependencies)
    (test-dependencies-keep_builtins)
    (test-embeds-remove)
    (test-embeds-update)
]
```

When tests fail, it's hard to trace which exact command failed.

## Solution

Generate an intermediate `.nu` script where each command is explicit:
```nushell
# Auto-generated test script
[
    (test-dependencies)
    (test-dependencies-keep_builtins)
    (test-embeds-remove)
    (test-embeds-update)
] | to nuon
```

This makes failures easy to trace by line number.

## Implementation

1. Add a helper function to generate test scripts with explicit commands
2. Refactor `main test-integration` to:
   - Generate script to a file (e.g., `99_integration_test.nu`)
   - Execute the script
   - Parse the nuon output
3. Add generated script to `.gitignore`

## Usage in other projects

This helper can be used by numd (which already depends on dotnu) to flatten its integration tests similarly.

## Reference

See numd's implementation in `toolkit.nu` for the pattern already applied there.
